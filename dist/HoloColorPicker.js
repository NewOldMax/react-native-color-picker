"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.HoloColorPicker = void 0;
const react_1 = __importDefault(require("react"));
const react_native_1 = require("react-native");
const tinycolor2_1 = __importDefault(require("tinycolor2"));
const slider_1 = __importDefault(require("@react-native-community/slider"));
const utils_1 = require("./utils");
class HoloColorPicker extends react_1.default.PureComponent {
    _layout;
    _pageX;
    _pageY;
    _isRTL;
    _pickerResponder;
    constructor(props, ctx) {
        super(props, ctx);
        const state = {
            color: { h: 0, s: 1, v: 1 },
            pickerSize: 0,
        };
        if (props.oldColor) {
            state.color = (0, tinycolor2_1.default)(props.oldColor).toHsv();
        }
        if (props.defaultColor) {
            state.color = (0, tinycolor2_1.default)(props.defaultColor).toHsv();
        }
        this.state = state;
        this._layout = { width: 0, height: 0, x: 0, y: 0 };
        this._pageX = 0;
        this._pageY = 0;
        this._onLayout = this._onLayout.bind(this);
        this._onSValueChange = this._onSValueChange.bind(this);
        this._onVValueChange = this._onVValueChange.bind(this);
        this._onColorSelected = this._onColorSelected.bind(this);
        this._onOldColorSelected = this._onOldColorSelected.bind(this);
        this._isRTL = react_native_1.I18nManager.isRTL;
        this._pickerResponder = (0, utils_1.createPanResponder)({
            onStart: this._handleColorChange,
            onMove: this._handleColorChange,
        });
    }
    _getColor() {
        const passedColor = typeof this.props.color === "string"
            ? (0, tinycolor2_1.default)(this.props.color).toHsv()
            : this.props.color;
        return passedColor || this.state.color;
    }
    _onColorSelected() {
        const { onColorSelected } = this.props;
        const color = (0, tinycolor2_1.default)(this._getColor()).toHexString();
        onColorSelected && onColorSelected(color);
    }
    _onOldColorSelected() {
        const { oldColor, onOldColorSelected } = this.props;
        const color = (0, tinycolor2_1.default)(oldColor);
        this.setState({ color: color.toHsv() });
        onOldColorSelected && onOldColorSelected(color.toHexString());
    }
    _onSValueChange(s) {
        const { h, v } = this._getColor();
        this._onColorChange({ h, s, v });
    }
    _onVValueChange(v) {
        const { h, s } = this._getColor();
        this._onColorChange({ h, s, v });
    }
    _onColorChange(color) {
        this.setState({ color });
        if (this.props.onColorChange) {
            this.props.onColorChange(color);
        }
    }
    _onLayout(l) {
        this._layout = l.nativeEvent.layout;
        const { width, height } = this._layout;
        const pickerSize = Math.min(width, height);
        if (this.state.pickerSize !== pickerSize) {
            this.setState({ pickerSize });
        }
        // layout.x, layout.y is always 0
        // we always measure because layout is the same even though picker is moved on the page
        react_native_1.InteractionManager.runAfterInteractions(() => {
            // measure only after (possible) animation ended
            this.refs.pickerContainer &&
                this.refs.pickerContainer.measure((x, y, width, height, pageX, pageY) => {
                    // picker position in the screen
                    this._pageX = pageX;
                    this._pageY = pageY;
                });
        });
    }
    _handleColorChange = ({ x, y }) => {
        const { s, v } = this._getColor();
        const marginLeft = (this._layout.width - this.state.pickerSize) / 2;
        const marginTop = (this._layout.height - this.state.pickerSize) / 2;
        const relativeX = x - this._pageX - marginLeft;
        const relativeY = y - this._pageY - marginTop;
        const h = this._computeHValue(relativeX, relativeY);
        this._onColorChange({ h, s, v });
        return true;
    };
    _computeHValue(x, y) {
        const mx = this.state.pickerSize / 2;
        const my = this.state.pickerSize / 2;
        const dx = x - mx;
        const dy = y - my;
        const rad = Math.atan2(dx, dy) + Math.PI + Math.PI / 2;
        return ((rad * 180) / Math.PI) % 360;
    }
    _hValueToRad(deg) {
        const rad = (deg * Math.PI) / 180;
        return rad - Math.PI - Math.PI / 2;
    }
    _getSlider() {
        if (this.props.hideSliders) {
            return undefined;
        }
        if (this.props.sliderComponent) {
            return this.props.sliderComponent;
        }
        if (!slider_1.default) {
            throw new Error("You need to install `@react-native-community/slider` and pass it (or any other Slider compatible component) as `sliderComponent` prop");
        }
        return slider_1.default;
    }
    getColor() {
        return (0, tinycolor2_1.default)(this._getColor()).toHexString();
    }
    render() {
        const { pickerSize } = this.state;
        const { oldColor, style } = this.props;
        const color = this._getColor();
        const { h, s, v } = color;
        const angle = this._hValueToRad(h);
        const selectedColor = (0, tinycolor2_1.default)(color).toHexString();
        const indicatorColor = (0, tinycolor2_1.default)({ h, s: 1, v: 1 }).toHexString();
        const computed = makeComputedStyles({
            pickerSize,
            selectedColor,
            indicatorColor,
            oldColor,
            angle,
            isRTL: this._isRTL,
        });
        const SliderComp = this._getSlider();
        return (<react_native_1.View style={style}>
        <react_native_1.View onLayout={this._onLayout} ref="pickerContainer" style={styles.pickerContainer}>
          {!pickerSize ? null : (<react_native_1.View>
              <react_native_1.View {...this._pickerResponder.panHandlers} style={[computed.picker]} collapsable={false}>
                <react_native_1.Image source={require("../resources/color-circle.png")} resizeMode="contain" style={[styles.pickerImage]}/>
                <react_native_1.View style={[styles.pickerIndicator, computed.pickerIndicator]}/>
              </react_native_1.View>
              {oldColor && (<react_native_1.TouchableOpacity style={[styles.selectedPreview, computed.selectedPreview]} onPress={this._onColorSelected} activeOpacity={0.7}/>)}
              {oldColor && (<react_native_1.TouchableOpacity style={[styles.originalPreview, computed.originalPreview]} onPress={this._onOldColorSelected} activeOpacity={0.7}/>)}
              {!oldColor && (<react_native_1.TouchableOpacity style={[
                        styles.selectedFullPreview,
                        computed.selectedFullPreview,
                    ]} onPress={this._onColorSelected} activeOpacity={0.7}/>)}
            </react_native_1.View>)}
        </react_native_1.View>
        {this.props.hideSliders ? null : (<react_native_1.View>
            <SliderComp value={s} onValueChange={this._onSValueChange}/>
            <SliderComp value={v} onValueChange={this._onVValueChange}/>
          </react_native_1.View>)}
      </react_native_1.View>);
    }
}
exports.HoloColorPicker = HoloColorPicker;
const makeComputedStyles = ({ indicatorColor, selectedColor, oldColor, angle, pickerSize, isRTL, }) => {
    const summarySize = 0.5 * pickerSize;
    const indicatorPickerRatio = 42 / 510; // computed from picker image
    const indicatorSize = indicatorPickerRatio * pickerSize;
    const pickerPadding = indicatorSize / 3;
    const indicatorRadius = pickerSize / 2 - indicatorSize / 2 - pickerPadding;
    const mx = pickerSize / 2;
    const my = pickerSize / 2;
    const dx = Math.cos(angle) * indicatorRadius;
    const dy = Math.sin(angle) * indicatorRadius;
    return {
        picker: {
            padding: pickerPadding,
            width: pickerSize,
            height: pickerSize,
        },
        pickerIndicator: {
            top: mx + dx - indicatorSize / 2,
            [isRTL ? "right" : "left"]: my + dy - indicatorSize / 2,
            width: indicatorSize,
            height: indicatorSize,
            borderRadius: indicatorSize / 2,
            backgroundColor: indicatorColor,
        },
        selectedPreview: {
            width: summarySize / 2,
            height: summarySize,
            top: pickerSize / 2 - summarySize / 2,
            left: Math.floor(pickerSize / 2),
            borderTopRightRadius: summarySize / 2,
            borderBottomRightRadius: summarySize / 2,
            backgroundColor: selectedColor,
        },
        originalPreview: {
            width: Math.ceil(summarySize / 2),
            height: summarySize,
            top: pickerSize / 2 - summarySize / 2,
            left: pickerSize / 2 - summarySize / 2,
            borderTopLeftRadius: summarySize / 2,
            borderBottomLeftRadius: summarySize / 2,
            backgroundColor: oldColor,
        },
        selectedFullPreview: {
            width: summarySize,
            height: summarySize,
            top: pickerSize / 2 - summarySize / 2,
            left: pickerSize / 2 - summarySize / 2,
            borderRadius: summarySize / 2,
            backgroundColor: selectedColor,
        },
    };
};
const styles = react_native_1.StyleSheet.create({
    pickerContainer: {
        flex: 1,
        alignItems: "center",
        justifyContent: "center",
    },
    pickerImage: {
        flex: 1,
        width: null,
        height: null,
    },
    pickerIndicator: {
        position: "absolute",
        // Shadow only works on iOS.
        shadowColor: "black",
        shadowOpacity: 0.3,
        shadowOffset: { width: 3, height: 3 },
        shadowRadius: 4,
        // This will elevate the view on Android, causing shadow to be drawn.
        elevation: 5,
    },
    selectedPreview: {
        position: "absolute",
        borderLeftWidth: 0,
    },
    originalPreview: {
        position: "absolute",
        borderRightWidth: 0,
    },
    selectedFullPreview: {
        position: "absolute",
    },
    pickerAlignment: {
        alignItems: "center",
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSG9sb0NvbG9yUGlja2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL0hvbG9Db2xvclBpY2tlci50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsa0RBQTBCO0FBQzFCLCtDQVFzQjtBQUN0Qiw0REFBbUM7QUFDbkMsNEVBQW9EO0FBR3BELG1DQUE2QztBQWdCN0MsTUFBYSxlQUFnQixTQUFRLGVBQUssQ0FBQyxhQUcxQztJQUNTLE9BQU8sQ0FBMEQ7SUFDakUsTUFBTSxDQUFTO0lBQ2YsTUFBTSxDQUFTO0lBQ2YsTUFBTSxDQUFVO0lBQ2hCLGdCQUFnQixDQUF1QjtJQUUvQyxZQUFZLEtBQXVCLEVBQUUsR0FBUTtRQUMzQyxLQUFLLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLE1BQU0sS0FBSyxHQUFHO1lBQ1osS0FBSyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7WUFDM0IsVUFBVSxFQUFFLENBQUM7U0FDZCxDQUFDO1FBQ0YsSUFBSSxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDbkIsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFBLG9CQUFTLEVBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2xELENBQUM7UUFDRCxJQUFJLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUN2QixLQUFLLENBQUMsS0FBSyxHQUFHLElBQUEsb0JBQVMsRUFBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDdEQsQ0FBQztRQUNELElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVB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QUMsR0FBRyxXQUFXLEdBQUcsQ0FBQztZQUNyQyxJQUFJLEVBQUUsVUFBVSxHQUFHLENBQUMsR0FBRyxXQUFXLEdBQUcsQ0FBQztZQUN0QyxZQUFZLEVBQUUsV0FBVyxHQUFHLENBQUM7WUFDN0IsZUFBZSxFQUFFLGFBQWE7U0FDL0I7S0FDRixDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsTUFBTSxNQUFNLEdBQUcseUJBQVUsQ0FBQyxNQUFNLENBQUM7SUFDL0IsZUFBZSxFQUFFO1FBQ2YsSUFBSSxFQUFFLENBQUM7UUFDUCxVQUFVLEVBQUUsUUFBUTtRQUNwQixjQUFjLEVBQUUsUUFBUTtLQUN6QjtJQUNELFdBQVcsRUFBRTtRQUNYLElBQUksRUFBRSxDQUFDO1FBQ1AsS0FBSyxFQUFFLElBQUk7UUFDWCxNQUFNLEVBQUUsSUFBSTtLQUNiO0lBQ0QsZUFBZSxFQUFFO1FBQ2YsUUFBUSxFQUFFLFVBQVU7UUFDcEIsNEJBQTRCO1FBQzVCLFdBQVcsRUFBRSxPQUFPO1FBQ3BCLGFBQWEsRUFBRSxHQUFHO1FBQ2xCLFlBQVksRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRTtRQUNyQyxZQUFZLEVBQUUsQ0FBQztRQUVmLHFFQUFxRTtRQUNyRSxTQUFTLEVBQUUsQ0FBQztLQUNiO0lBQ0QsZUFBZSxFQUFFO1FBQ2YsUUFBUSxFQUFFLFVBQVU7UUFDcEIsZUFBZSxFQUFFLENBQUM7S0FDbkI7SUFDRCxlQUFlLEVBQUU7UUFDZixRQUFRLEVBQUUsVUFBVTtRQUNwQixnQkFBZ0IsRUFBRSxDQUFDO0tBQ3BCO0lBQ0QsbUJBQW1CLEVBQUU7UUFDbkIsUUFBUSxFQUFFLFVBQVU7S0FDckI7SUFDRCxlQUFlLEVBQUU7UUFDZixVQUFVLEVBQUUsUUFBUTtLQUNyQjtDQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7XG4gIEkxOG5NYW5hZ2VyLFxuICBJbWFnZSxcbiAgSW50ZXJhY3Rpb25NYW5hZ2VyLFxuICBQYW5SZXNwb25kZXJJbnN0YW5jZSxcbiAgU3R5bGVTaGVldCxcbiAgVG91Y2hhYmxlT3BhY2l0eSxcbiAgVmlldyxcbn0gZnJvbSBcInJlYWN0LW5hdGl2ZVwiO1xuaW1wb3J0IHRpbnljb2xvciBmcm9tIFwidGlueWNvbG9yMlwiO1xuaW1wb3J0IFNsaWRlciBmcm9tIFwiQHJlYWN0LW5hdGl2ZS1jb21tdW5pdHkvc2xpZGVyXCI7XG5cbmltcG9ydCB7IEhzdkNvbG9yLCBJUGlja2VyUHJvcHMsIFBvaW50MkQgfSBmcm9tIFwiLi90eXBlSGVscGVyc1wiO1xuaW1wb3J0IHsgY3JlYXRlUGFuUmVzcG9uZGVyIH0gZnJvbSBcIi4vdXRpbHNcIjtcblxudHlwZSBTbGlkZXJQcm9wcyA9IHtcbiAgb25WYWx1ZUNoYW5nZT86ICh2YWx1ZTogbnVtYmVyKSA9PiB2b2lkO1xuICB2YWx1ZT86IG51bWJlcjtcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUhvbG9QaWNrZXJQcm9wcyBleHRlbmRzIElQaWNrZXJQcm9wcyB7XG4gIHNsaWRlckNvbXBvbmVudD86IFJlYWN0LkNvbXBvbmVudDxTbGlkZXJQcm9wcz47XG59XG5cbmV4cG9ydCB0eXBlIElIb2xvUGlja2VyU3RhdGUgPSB7XG4gIGNvbG9yOiBIc3ZDb2xvcjtcbiAgcGlja2VyU2l6ZTogbnVtYmVyO1xufTtcblxuZXhwb3J0IGNsYXNzIEhvbG9Db2xvclBpY2tlciBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8XG4gIElIb2xvUGlja2VyUHJvcHMsXG4gIElIb2xvUGlja2VyU3RhdGVcbj4ge1xuICBwcml2YXRlIF9sYXlvdXQ6IHsgd2lkdGg6IG51bWJlcjsgaGVpZ2h0OiBudW1iZXI7IHg6IG51bWJlcjsgeTogbnVtYmVyIH07XG4gIHByaXZhdGUgX3BhZ2VYOiBudW1iZXI7XG4gIHByaXZhdGUgX3BhZ2VZOiBudW1iZXI7XG4gIHByaXZhdGUgX2lzUlRMOiBib29sZWFuO1xuICBwcml2YXRlIF9waWNrZXJSZXNwb25kZXI6IFBhblJlc3BvbmRlckluc3RhbmNlO1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBJSG9sb1BpY2tlclByb3BzLCBjdHg6IGFueSkge1xuICAgIHN1cGVyKHByb3BzLCBjdHgpO1xuICAgIGNvbnN0IHN0YXRlID0ge1xuICAgICAgY29sb3I6IHsgaDogMCwgczogMSwgdjogMSB9LFxuICAgICAgcGlja2VyU2l6ZTogMCxcbiAgICB9O1xuICAgIGlmIChwcm9wcy5vbGRDb2xvcikge1xuICAgICAgc3RhdGUuY29sb3IgPSB0aW55Y29sb3IocHJvcHMub2xkQ29sb3IpLnRvSHN2KCk7XG4gICAgfVxuICAgIGlmIChwcm9wcy5kZWZhdWx0Q29sb3IpIHtcbiAgICAgIHN0YXRlLmNvbG9yID0gdGlueWNvbG9yKHByb3BzLmRlZmF1bHRDb2xvcikudG9Ic3YoKTtcbiAgICB9XG4gICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgIHRoaXMuX2xheW91dCA9IHsgd2lkdGg6IDAsIGhlaWdodDogMCwgeDogMCwgeTogMCB9O1xuICAgIHRoaXMuX3BhZ2VYID0gMDtcbiAgICB0aGlzLl9wYWdlWSA9IDA7XG4gICAgdGhpcy5fb25MYXlvdXQgPSB0aGlzLl9vbkxheW91dC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX29uU1ZhbHVlQ2hhbmdlID0gdGhpcy5fb25TVmFsdWVDaGFuZ2UuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vblZWYWx1ZUNoYW5nZSA9IHRoaXMuX29uVlZhbHVlQ2hhbmdlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fb25Db2xvclNlbGVjdGVkID0gdGhpcy5fb25Db2xvclNlbGVjdGVkLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fb25PbGRDb2xvclNlbGVjdGVkID0gdGhpcy5fb25PbGRDb2xvclNlbGVjdGVkLmJpbmQodGhpcyk7XG4gICAgdGhpcy5faXNSVEwgPSBJMThuTWFuYWdlci5pc1JUTDtcbiAgICB0aGlzLl9waWNrZXJSZXNwb25kZXIgPSBjcmVhdGVQYW5SZXNwb25kZXIoe1xuICAgICAgb25TdGFydDogdGhpcy5faGFuZGxlQ29sb3JDaGFuZ2UsXG4gICAgICBvbk1vdmU6IHRoaXMuX2hhbmRsZUNvbG9yQ2hhbmdlLFxuICAgIH0pO1xuICB9XG5cbiAgX2dldENvbG9yKCkge1xuICAgIGNvbnN0IHBhc3NlZENvbG9yID1cbiAgICAgIHR5cGVvZiB0aGlzLnByb3BzLmNvbG9yID09PSBcInN0cmluZ1wiXG4gICAgICAgID8gdGlueWNvbG9yKHRoaXMucHJvcHMuY29sb3IpLnRvSHN2KClcbiAgICAgICAgOiB0aGlzLnByb3BzLmNvbG9yO1xuICAgIHJldHVybiBwYXNzZWRDb2xvciB8fCB0aGlzLnN0YXRlLmNvbG9yO1xuICB9XG5cbiAgX29uQ29sb3JTZWxlY3RlZCgpIHtcbiAgICBjb25zdCB7IG9uQ29sb3JTZWxlY3RlZCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBjb2xvciA9IHRpbnljb2xvcih0aGlzLl9nZXRDb2xvcigpKS50b0hleFN0cmluZygpO1xuICAgIG9uQ29sb3JTZWxlY3RlZCAmJiBvbkNvbG9yU2VsZWN0ZWQoY29sb3IpO1xuICB9XG5cbiAgX29uT2xkQ29sb3JTZWxlY3RlZCgpIHtcbiAgICBjb25zdCB7IG9sZENvbG9yLCBvbk9sZENvbG9yU2VsZWN0ZWQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgY29sb3IgPSB0aW55Y29sb3Iob2xkQ29sb3IpO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBjb2xvcjogY29sb3IudG9Ic3YoKSB9KTtcbiAgICBvbk9sZENvbG9yU2VsZWN0ZWQgJiYgb25PbGRDb2xvclNlbGVjdGVkKGNvbG9yLnRvSGV4U3RyaW5nKCkpO1xuICB9XG5cbiAgX29uU1ZhbHVlQ2hhbmdlKHM6IG51bWJlcikge1xuICAgIGNvbnN0IHsgaCwgdiB9ID0gdGhpcy5fZ2V0Q29sb3IoKTtcbiAgICB0aGlzLl9vbkNvbG9yQ2hhbmdlKHsgaCwgcywgdiB9KTtcbiAgfVxuXG4gIF9vblZWYWx1ZUNoYW5nZSh2OiBudW1iZXIpIHtcbiAgICBjb25zdCB7IGgsIHMgfSA9IHRoaXMuX2dldENvbG9yKCk7XG4gICAgdGhpcy5fb25Db2xvckNoYW5nZSh7IGgsIHMsIHYgfSk7XG4gIH1cblxuICBfb25Db2xvckNoYW5nZShjb2xvcjogeyBoOiBudW1iZXI7IHM6IGFueTsgdjogYW55IH0pIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgY29sb3IgfSk7XG4gICAgaWYgKHRoaXMucHJvcHMub25Db2xvckNoYW5nZSkge1xuICAgICAgdGhpcy5wcm9wcy5vbkNvbG9yQ2hhbmdlKGNvbG9yKTtcbiAgICB9XG4gIH1cblxuICBfb25MYXlvdXQobDoge1xuICAgIG5hdGl2ZUV2ZW50OiB7XG4gICAgICBsYXlvdXQ6IHsgd2lkdGg6IG51bWJlcjsgaGVpZ2h0OiBudW1iZXI7IHg6IG51bWJlcjsgeTogbnVtYmVyIH07XG4gICAgfTtcbiAgfSkge1xuICAgIHRoaXMuX2xheW91dCA9IGwubmF0aXZlRXZlbnQubGF5b3V0O1xuICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gdGhpcy5fbGF5b3V0O1xuICAgIGNvbnN0IHBpY2tlclNpemUgPSBNYXRoLm1pbih3aWR0aCwgaGVpZ2h0KTtcbiAgICBpZiAodGhpcy5zdGF0ZS5waWNrZXJTaXplICE9PSBwaWNrZXJTaXplKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgcGlja2VyU2l6ZSB9KTtcbiAgICB9XG4gICAgLy8gbGF5b3V0LngsIGxheW91dC55IGlzIGFsd2F5cyAwXG4gICAgLy8gd2UgYWx3YXlzIG1lYXN1cmUgYmVjYXVzZSBsYXlvdXQgaXMgdGhlIHNhbWUgZXZlbiB0aG91Z2ggcGlja2VyIGlzIG1vdmVkIG9uIHRoZSBwYWdlXG4gICAgSW50ZXJhY3Rpb25NYW5hZ2VyLnJ1bkFmdGVySW50ZXJhY3Rpb25zKCgpID0+IHtcbiAgICAgIC8vIG1lYXN1cmUgb25seSBhZnRlciAocG9zc2libGUpIGFuaW1hdGlvbiBlbmRlZFxuICAgICAgdGhpcy5yZWZzLnBpY2tlckNvbnRhaW5lciAmJlxuICAgICAgICAodGhpcy5yZWZzLnBpY2tlckNvbnRhaW5lciBhcyBhbnkpLm1lYXN1cmUoXG4gICAgICAgICAgKFxuICAgICAgICAgICAgeDogbnVtYmVyLFxuICAgICAgICAgICAgeTogbnVtYmVyLFxuICAgICAgICAgICAgd2lkdGg6IG51bWJlcixcbiAgICAgICAgICAgIGhlaWdodDogbnVtYmVyLFxuICAgICAgICAgICAgcGFnZVg6IG51bWJlcixcbiAgICAgICAgICAgIHBhZ2VZOiBudW1iZXJcbiAgICAgICAgICApID0+IHtcbiAgICAgICAgICAgIC8vIHBpY2tlciBwb3NpdGlvbiBpbiB0aGUgc2NyZWVuXG4gICAgICAgICAgICB0aGlzLl9wYWdlWCA9IHBhZ2VYO1xuICAgICAgICAgICAgdGhpcy5fcGFnZVkgPSBwYWdlWTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBfaGFuZGxlQ29sb3JDaGFuZ2UgPSAoeyB4LCB5IH06IFBvaW50MkQpID0+IHtcbiAgICBjb25zdCB7IHMsIHYgfSA9IHRoaXMuX2dldENvbG9yKCk7XG4gICAgY29uc3QgbWFyZ2luTGVmdCA9ICh0aGlzLl9sYXlvdXQud2lkdGggLSB0aGlzLnN0YXRlLnBpY2tlclNpemUpIC8gMjtcbiAgICBjb25zdCBtYXJnaW5Ub3AgPSAodGhpcy5fbGF5b3V0LmhlaWdodCAtIHRoaXMuc3RhdGUucGlja2VyU2l6ZSkgLyAyO1xuICAgIGNvbnN0IHJlbGF0aXZlWCA9IHggLSB0aGlzLl9wYWdlWCAtIG1hcmdpbkxlZnQ7XG4gICAgY29uc3QgcmVsYXRpdmVZID0geSAtIHRoaXMuX3BhZ2VZIC0gbWFyZ2luVG9wO1xuICAgIGNvbnN0IGggPSB0aGlzLl9jb21wdXRlSFZhbHVlKHJlbGF0aXZlWCwgcmVsYXRpdmVZKTtcbiAgICB0aGlzLl9vbkNvbG9yQ2hhbmdlKHsgaCwgcywgdiB9KTtcblxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gIF9jb21wdXRlSFZhbHVlKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgY29uc3QgbXggPSB0aGlzLnN0YXRlLnBpY2tlclNpemUgLyAyO1xuICAgIGNvbnN0IG15ID0gdGhpcy5zdGF0ZS5waWNrZXJTaXplIC8gMjtcbiAgICBjb25zdCBkeCA9IHggLSBteDtcbiAgICBjb25zdCBkeSA9IHkgLSBteTtcbiAgICBjb25zdCByYWQgPSBNYXRoLmF0YW4yKGR4LCBkeSkgKyBNYXRoLlBJICsgTWF0aC5QSSAvIDI7XG4gICAgcmV0dXJuICgocmFkICogMTgwKSAvIE1hdGguUEkpICUgMzYwO1xuICB9XG5cbiAgX2hWYWx1ZVRvUmFkKGRlZzogbnVtYmVyKSB7XG4gICAgY29uc3QgcmFkID0gKGRlZyAqIE1hdGguUEkpIC8gMTgwO1xuICAgIHJldHVybiByYWQgLSBNYXRoLlBJIC0gTWF0aC5QSSAvIDI7XG4gIH1cblxuICBfZ2V0U2xpZGVyKCk6IHR5cGVvZiBTbGlkZXIgfCBhbnkge1xuICAgIGlmICh0aGlzLnByb3BzLmhpZGVTbGlkZXJzKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnByb3BzLnNsaWRlckNvbXBvbmVudCkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcHMuc2xpZGVyQ29tcG9uZW50IGFzIGFueTtcbiAgICB9XG5cbiAgICBpZiAoIVNsaWRlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIllvdSBuZWVkIHRvIGluc3RhbGwgYEByZWFjdC1uYXRpdmUtY29tbXVuaXR5L3NsaWRlcmAgYW5kIHBhc3MgaXQgKG9yIGFueSBvdGhlciBTbGlkZXIgY29tcGF0aWJsZSBjb21wb25lbnQpIGFzIGBzbGlkZXJDb21wb25lbnRgIHByb3BcIlxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gU2xpZGVyO1xuICB9XG5cbiAgZ2V0Q29sb3IoKSB7XG4gICAgcmV0dXJuIHRpbnljb2xvcih0aGlzLl9nZXRDb2xvcigpKS50b0hleFN0cmluZygpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgcGlja2VyU2l6ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IG9sZENvbG9yLCBzdHlsZSB9ID0gdGhpcy5wcm9wcztcblxuICAgIGNvbnN0IGNvbG9yID0gdGhpcy5fZ2V0Q29sb3IoKTtcbiAgICBjb25zdCB7IGgsIHMsIHYgfSA9IGNvbG9yO1xuICAgIGNvbnN0IGFuZ2xlID0gdGhpcy5faFZhbHVlVG9SYWQoaCk7XG4gICAgY29uc3Qgc2VsZWN0ZWRDb2xvciA9IHRpbnljb2xvcihjb2xvcikudG9IZXhTdHJpbmcoKTtcbiAgICBjb25zdCBpbmRpY2F0b3JDb2xvciA9IHRpbnljb2xvcih7IGgsIHM6IDEsIHY6IDEgfSkudG9IZXhTdHJpbmcoKTtcblxuICAgIGNvbnN0IGNvbXB1dGVkID0gbWFrZUNvbXB1dGVkU3R5bGVzKHtcbiAgICAgIHBpY2tlclNpemUsXG4gICAgICBzZWxlY3RlZENvbG9yLFxuICAgICAgaW5kaWNhdG9yQ29sb3IsXG4gICAgICBvbGRDb2xvcixcbiAgICAgIGFuZ2xlLFxuICAgICAgaXNSVEw6IHRoaXMuX2lzUlRMLFxuICAgIH0pO1xuXG4gICAgY29uc3QgU2xpZGVyQ29tcCA9IHRoaXMuX2dldFNsaWRlcigpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxWaWV3IHN0eWxlPXtzdHlsZX0+XG4gICAgICAgIDxWaWV3XG4gICAgICAgICAgb25MYXlvdXQ9e3RoaXMuX29uTGF5b3V0fVxuICAgICAgICAgIHJlZj1cInBpY2tlckNvbnRhaW5lclwiXG4gICAgICAgICAgc3R5bGU9e3N0eWxlcy5waWNrZXJDb250YWluZXJ9XG4gICAgICAgID5cbiAgICAgICAgICB7IXBpY2tlclNpemUgPyBudWxsIDogKFxuICAgICAgICAgICAgPFZpZXc+XG4gICAgICAgICAgICAgIDxWaWV3XG4gICAgICAgICAgICAgICAgey4uLnRoaXMuX3BpY2tlclJlc3BvbmRlci5wYW5IYW5kbGVyc31cbiAgICAgICAgICAgICAgICBzdHlsZT17W2NvbXB1dGVkLnBpY2tlcl19XG4gICAgICAgICAgICAgICAgY29sbGFwc2FibGU9e2ZhbHNlfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPEltYWdlXG4gICAgICAgICAgICAgICAgICBzb3VyY2U9e3JlcXVpcmUoXCIuLi9yZXNvdXJjZXMvY29sb3ItY2lyY2xlLnBuZ1wiKX1cbiAgICAgICAgICAgICAgICAgIHJlc2l6ZU1vZGU9XCJjb250YWluXCJcbiAgICAgICAgICAgICAgICAgIHN0eWxlPXtbc3R5bGVzLnBpY2tlckltYWdlXX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDxWaWV3XG4gICAgICAgICAgICAgICAgICBzdHlsZT17W3N0eWxlcy5waWNrZXJJbmRpY2F0b3IsIGNvbXB1dGVkLnBpY2tlckluZGljYXRvcl19XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPC9WaWV3PlxuICAgICAgICAgICAgICB7b2xkQ29sb3IgJiYgKFxuICAgICAgICAgICAgICAgIDxUb3VjaGFibGVPcGFjaXR5XG4gICAgICAgICAgICAgICAgICBzdHlsZT17W3N0eWxlcy5zZWxlY3RlZFByZXZpZXcsIGNvbXB1dGVkLnNlbGVjdGVkUHJldmlld119XG4gICAgICAgICAgICAgICAgICBvblByZXNzPXt0aGlzLl9vbkNvbG9yU2VsZWN0ZWR9XG4gICAgICAgICAgICAgICAgICBhY3RpdmVPcGFjaXR5PXswLjd9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAge29sZENvbG9yICYmIChcbiAgICAgICAgICAgICAgICA8VG91Y2hhYmxlT3BhY2l0eVxuICAgICAgICAgICAgICAgICAgc3R5bGU9e1tzdHlsZXMub3JpZ2luYWxQcmV2aWV3LCBjb21wdXRlZC5vcmlnaW5hbFByZXZpZXddfVxuICAgICAgICAgICAgICAgICAgb25QcmVzcz17dGhpcy5fb25PbGRDb2xvclNlbGVjdGVkfVxuICAgICAgICAgICAgICAgICAgYWN0aXZlT3BhY2l0eT17MC43fVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIHshb2xkQ29sb3IgJiYgKFxuICAgICAgICAgICAgICAgIDxUb3VjaGFibGVPcGFjaXR5XG4gICAgICAgICAgICAgICAgICBzdHlsZT17W1xuICAgICAgICAgICAgICAgICAgICBzdHlsZXMuc2VsZWN0ZWRGdWxsUHJldmlldyxcbiAgICAgICAgICAgICAgICAgICAgY29tcHV0ZWQuc2VsZWN0ZWRGdWxsUHJldmlldyxcbiAgICAgICAgICAgICAgICAgIF19XG4gICAgICAgICAgICAgICAgICBvblByZXNzPXt0aGlzLl9vbkNvbG9yU2VsZWN0ZWR9XG4gICAgICAgICAgICAgICAgICBhY3RpdmVPcGFjaXR5PXswLjd9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIDwvVmlldz5cbiAgICAgICAgICApfVxuICAgICAgICA8L1ZpZXc+XG4gICAgICAgIHt0aGlzLnByb3BzLmhpZGVTbGlkZXJzID8gbnVsbCA6IChcbiAgICAgICAgICA8Vmlldz5cbiAgICAgICAgICAgIDxTbGlkZXJDb21wIHZhbHVlPXtzfSBvblZhbHVlQ2hhbmdlPXt0aGlzLl9vblNWYWx1ZUNoYW5nZX0gLz5cbiAgICAgICAgICAgIDxTbGlkZXJDb21wIHZhbHVlPXt2fSBvblZhbHVlQ2hhbmdlPXt0aGlzLl9vblZWYWx1ZUNoYW5nZX0gLz5cbiAgICAgICAgICA8L1ZpZXc+XG4gICAgICAgICl9XG4gICAgICA8L1ZpZXc+XG4gICAgKTtcbiAgfVxufVxuXG5jb25zdCBtYWtlQ29tcHV0ZWRTdHlsZXMgPSAoe1xuICBpbmRpY2F0b3JDb2xvcixcbiAgc2VsZWN0ZWRDb2xvcixcbiAgb2xkQ29sb3IsXG4gIGFuZ2xlLFxuICBwaWNrZXJTaXplLFxuICBpc1JUTCxcbn06IGFueSkgPT4ge1xuICBjb25zdCBzdW1tYXJ5U2l6ZSA9IDAuNSAqIHBpY2tlclNpemU7XG4gIGNvbnN0IGluZGljYXRvclBpY2tlclJhdGlvID0gNDIgLyA1MTA7IC8vIGNvbXB1dGVkIGZyb20gcGlja2VyIGltYWdlXG4gIGNvbnN0IGluZGljYXRvclNpemUgPSBpbmRpY2F0b3JQaWNrZXJSYXRpbyAqIHBpY2tlclNpemU7XG4gIGNvbnN0IHBpY2tlclBhZGRpbmcgPSBpbmRpY2F0b3JTaXplIC8gMztcbiAgY29uc3QgaW5kaWNhdG9yUmFkaXVzID0gcGlja2VyU2l6ZSAvIDIgLSBpbmRpY2F0b3JTaXplIC8gMiAtIHBpY2tlclBhZGRpbmc7XG4gIGNvbnN0IG14ID0gcGlja2VyU2l6ZSAvIDI7XG4gIGNvbnN0IG15ID0gcGlja2VyU2l6ZSAvIDI7XG4gIGNvbnN0IGR4ID0gTWF0aC5jb3MoYW5nbGUpICogaW5kaWNhdG9yUmFkaXVzO1xuICBjb25zdCBkeSA9IE1hdGguc2luKGFuZ2xlKSAqIGluZGljYXRvclJhZGl1cztcbiAgcmV0dXJuIHtcbiAgICBwaWNrZXI6IHtcbiAgICAgIHBhZGRpbmc6IHBpY2tlclBhZGRpbmcsXG4gICAgICB3aWR0aDogcGlja2VyU2l6ZSxcbiAgICAgIGhlaWdodDogcGlja2VyU2l6ZSxcbiAgICB9LFxuICAgIHBpY2tlckluZGljYXRvcjoge1xuICAgICAgdG9wOiBteCArIGR4IC0gaW5kaWNhdG9yU2l6ZSAvIDIsXG4gICAgICBbaXNSVEwgPyBcInJpZ2h0XCIgOiBcImxlZnRcIl06IG15ICsgZHkgLSBpbmRpY2F0b3JTaXplIC8gMixcbiAgICAgIHdpZHRoOiBpbmRpY2F0b3JTaXplLFxuICAgICAgaGVpZ2h0OiBpbmRpY2F0b3JTaXplLFxuICAgICAgYm9yZGVyUmFkaXVzOiBpbmRpY2F0b3JTaXplIC8gMixcbiAgICAgIGJhY2tncm91bmRDb2xvcjogaW5kaWNhdG9yQ29sb3IsXG4gICAgfSxcbiAgICBzZWxlY3RlZFByZXZpZXc6IHtcbiAgICAgIHdpZHRoOiBzdW1tYXJ5U2l6ZSAvIDIsXG4gICAgICBoZWlnaHQ6IHN1bW1hcnlTaXplLFxuICAgICAgdG9wOiBwaWNrZXJTaXplIC8gMiAtIHN1bW1hcnlTaXplIC8gMixcbiAgICAgIGxlZnQ6IE1hdGguZmxvb3IocGlja2VyU2l6ZSAvIDIpLFxuICAgICAgYm9yZGVyVG9wUmlnaHRSYWRpdXM6IHN1bW1hcnlTaXplIC8gMixcbiAgICAgIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzOiBzdW1tYXJ5U2l6ZSAvIDIsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6IHNlbGVjdGVkQ29sb3IsXG4gICAgfSxcbiAgICBvcmlnaW5hbFByZXZpZXc6IHtcbiAgICAgIHdpZHRoOiBNYXRoLmNlaWwoc3VtbWFyeVNpemUgLyAyKSxcbiAgICAgIGhlaWdodDogc3VtbWFyeVNpemUsXG4gICAgICB0b3A6IHBpY2tlclNpemUgLyAyIC0gc3VtbWFyeVNpemUgLyAyLFxuICAgICAgbGVmdDogcGlja2VyU2l6ZSAvIDIgLSBzdW1tYXJ5U2l6ZSAvIDIsXG4gICAgICBib3JkZXJUb3BMZWZ0UmFkaXVzOiBzdW1tYXJ5U2l6ZSAvIDIsXG4gICAgICBib3JkZXJCb3R0b21MZWZ0UmFkaXVzOiBzdW1tYXJ5U2l6ZSAvIDIsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6IG9sZENvbG9yLFxuICAgIH0sXG4gICAgc2VsZWN0ZWRGdWxsUHJldmlldzoge1xuICAgICAgd2lkdGg6IHN1bW1hcnlTaXplLFxuICAgICAgaGVpZ2h0OiBzdW1tYXJ5U2l6ZSxcbiAgICAgIHRvcDogcGlja2VyU2l6ZSAvIDIgLSBzdW1tYXJ5U2l6ZSAvIDIsXG4gICAgICBsZWZ0OiBwaWNrZXJTaXplIC8gMiAtIHN1bW1hcnlTaXplIC8gMixcbiAgICAgIGJvcmRlclJhZGl1czogc3VtbWFyeVNpemUgLyAyLFxuICAgICAgYmFja2dyb3VuZENvbG9yOiBzZWxlY3RlZENvbG9yLFxuICAgIH0sXG4gIH07XG59O1xuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIHBpY2tlckNvbnRhaW5lcjoge1xuICAgIGZsZXg6IDEsXG4gICAgYWxpZ25JdGVtczogXCJjZW50ZXJcIixcbiAgICBqdXN0aWZ5Q29udGVudDogXCJjZW50ZXJcIixcbiAgfSxcbiAgcGlja2VySW1hZ2U6IHtcbiAgICBmbGV4OiAxLFxuICAgIHdpZHRoOiBudWxsLFxuICAgIGhlaWdodDogbnVsbCxcbiAgfSxcbiAgcGlja2VySW5kaWNhdG9yOiB7XG4gICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICAvLyBTaGFkb3cgb25seSB3b3JrcyBvbiBpT1MuXG4gICAgc2hhZG93Q29sb3I6IFwiYmxhY2tcIixcbiAgICBzaGFkb3dPcGFjaXR5OiAwLjMsXG4gICAgc2hhZG93T2Zmc2V0OiB7IHdpZHRoOiAzLCBoZWlnaHQ6IDMgfSxcbiAgICBzaGFkb3dSYWRpdXM6IDQsXG5cbiAgICAvLyBUaGlzIHdpbGwgZWxldmF0ZSB0aGUgdmlldyBvbiBBbmRyb2lkLCBjYXVzaW5nIHNoYWRvdyB0byBiZSBkcmF3bi5cbiAgICBlbGV2YXRpb246IDUsXG4gIH0sXG4gIHNlbGVjdGVkUHJldmlldzoge1xuICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG4gICAgYm9yZGVyTGVmdFdpZHRoOiAwLFxuICB9LFxuICBvcmlnaW5hbFByZXZpZXc6IHtcbiAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgIGJvcmRlclJpZ2h0V2lkdGg6IDAsXG4gIH0sXG4gIHNlbGVjdGVkRnVsbFByZXZpZXc6IHtcbiAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICB9LFxuICBwaWNrZXJBbGlnbm1lbnQ6IHtcbiAgICBhbGlnbkl0ZW1zOiBcImNlbnRlclwiLFxuICB9LFxufSk7XG4iXX0=